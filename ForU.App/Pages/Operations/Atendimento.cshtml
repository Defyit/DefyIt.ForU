@page
@model DefyIt.ForU.App.Pages.Operations.AtendimentoModel
@{
    ViewData["Title"] = "Atendimento";
}
<!-- Tabs Navbar -->
<nav class="tabs-navbar">
  <ul class="nav" id="pills-tab" role="tablist">
    <!-- ABA OPERAÇÃO (AGORA APENAS LABEL - NÃO CLICÁVEL) -->
    <li class="nav-item">
      <span class="nav-link disabled bg-secondary text-white">
        <i class="bi bi-flag"></i> PICPAY
      </span>
    </li>
  </ul>
</nav>

<!-- Container principal -->
<div class="container-fluid content-container">
  <div class="tab-content" id="pills-tabContent">
    <!-- Aba OPERAÇÃO -->
    <div
      class="tab-pane fade show active"
      id="pills-operacao"
      role="tabpanel"
      aria-labelledby="pills-operacao-tab"
      tabindex="0"
    >
      <div class="container">
        <!-- Card principal - Status de aguardando -->
        <div
          class="p-4 mb-4 bg-light border rounded d-flex justify-content-between align-items-center"
        >
          <div>
            <div
              class="spinner-border text-primary"
              style="width: 4rem; height: 4rem"
              role="status"
            >
              <span class="visually-hidden">Carregando...</span>
            </div>
            <h5 class="mt-3 mb-2">
              <i class="bi bi-clock"></i>Aguardando próximo atendimento...
            </h5>
            <p class="mb-0 text-muted">
              Sistema buscando automaticamente por novos contatos
            </p>
          </div>
          <div class="text-end">
            <div class="d-flex flex-column gap-2">
              <button class="btn btn-outline-primary">
                <i class="bi bi-pause"></i>Pausar
              </button>
              <button class="btn btn-outline-secondary">
                <i class="bi bi-gear"></i>Configurar
              </button>
            </div>
          </div>
        </div>

        <!-- Cards de estatísticas -->
        <div class="row mb-4">
          <!-- Card 1 - Atendimentos -->
          <div class="col-lg-3 col-md-6 mb-3">
            <div class="card border-0 shadow-sm h-100">
              <div class="card-body d-flex align-items-center">
                <div
                  class="bg-primary bg-opacity-10 rounded-circle me-3 d-flex align-items-center justify-content-center"
                >
                  <i class="bi bi-headset text-primary fs-4"></i>
                </div>
                <div>
                  <h6 class="mb-0 text-muted">Atendimentos Hoje</h6>
                  <h4 class="mb-0 fw-bold">15</h4>
                </div>
              </div>
            </div>
          </div>

          <!-- Card 2 - Tempo médio -->
          <div class="col-lg-3 col-md-6 mb-3">
            <div class="card border-0 shadow-sm h-100">
              <div class="card-body d-flex align-items-center">
                <div
                  class="bg-success bg-opacity-10 rounded-circle me-3 d-flex align-items-center justify-content-center"
                >
                  <i class="bi bi-clock text-success fs-4"></i>
                </div>
                <div>
                  <h6 class="mb-0 text-muted">Tempo Médio</h6>
                  <h4 class="mb-0 fw-bold">4:32</h4>
                </div>
              </div>
            </div>
          </div>

          <!-- Card 3 - Conversões -->
          <div class="col-lg-3 col-md-6 mb-3">
            <div class="card border-0 shadow-sm h-100">
              <div class="card-body d-flex align-items-center">
                <div
                  class="bg-info bg-opacity-10 rounded-circle me-3 d-flex align-items-center justify-content-center"
                >
                  <i class="bi bi-graph-up text-info fs-4"></i>
                </div>
                <div>
                  <h6 class="mb-0 text-muted">Conversões</h6>
                  <h4 class="mb-0 fw-bold">68%</h4>
                </div>
              </div>
            </div>
          </div>

          <!-- Card 4 - Em pausa -->
          <div class="col-lg-3 col-md-6 mb-3">
            <div class="card border-0 shadow-sm h-100">
              <div class="card-body d-flex align-items-center">
                <div
                  class="bg-warning bg-opacity-10 rounded-circle me-3 d-flex align-items-center justify-content-center"
                >
                  <i class="bi bi-pause text-warning fs-4"></i>
                </div>
                <div>
                  <h6 class="mb-0 text-muted">Tempo em Pausa</h6>
                  <h4 class="mb-0 fw-bold">1:15</h4>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Seção de ações rápidas -->
        <div class="card border-0 shadow-sm mb-4">
          <div class="card-header bg-white border-0">
            <h5 class="mb-0">
              <i class="bi bi-lightning"></i>Ações Rápidas
            </h5>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-4 mb-3">
                <button
                  class="btn btn-outline-primary w-100 d-flex align-items-center justify-content-center gap-2"
                  data-bs-toggle="offcanvas"
                  data-bs-target="#offcanvasAgendamento"
                >
                  <i class="bi bi-calendar-plus"></i>
                  Agendar Retorno
                </button>
              </div>
              <div class="col-md-4 mb-3">
                <button
                  class="btn btn-outline-success w-100 d-flex align-items-center justify-content-center gap-2"
                >
                  <i class="bi bi-telephone"></i>
                  Discagem Manual
                </button>
              </div>
              <div class="col-md-4 mb-3">
                <button
                  class="btn btn-outline-info w-100 d-flex align-items-center justify-content-center gap-2"
                >
                  <i class="bi bi-journal-text"></i>
                  Histórico
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Últimos atendimentos -->
        <div class="card border-0 shadow-sm">
          <div class="card-header bg-white border-0">
            <h5 class="mb-0">
              <i class="bi bi-clock-history"></i>Últimos Atendimentos
            </h5>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover">
                <thead class="table-light">
                  <tr>
                    <th>Cliente</th>
                    <th>Telefone</th>
                    <th>Horário</th>
                    <th>Duração</th>
                    <th>Status</th>
                    <th>Ações</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>
                      <div>
                        <strong>João Silva</strong>
                        <br />
                        <small class="text-muted">ID: 12345</small>
                      </div>
                    </td>
                    <td>(11) 99999-9999</td>
                    <td>14:30</td>
                    <td>5:42</td>
                    <td>
                      <span class="badge bg-success">Convertido</span>
                    </td>
                    <td>
                      <button class="btn btn-sm btn-outline-primary">
                        <i class="bi bi-eye"></i>
                      </button>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <div>
                        <strong>Maria Santos</strong>
                        <br />
                        <small class="text-muted">ID: 12346</small>
                      </div>
                    </td>
                    <td>(11) 88888-8888</td>
                    <td>14:15</td>
                    <td>3:21</td>
                    <td>
                      <span class="badge bg-warning text-dark">Agendado</span>
                    </td>
                    <td>
                      <button class="btn btn-sm btn-outline-primary">
                        <i class="bi bi-eye"></i>
                      </button>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <div>
                        <strong>Pedro Costa</strong>
                        <br />
                        <small class="text-muted">ID: 12347</small>
                      </div>
                    </td>
                    <td>(11) 77777-7777</td>
                    <td>13:45</td>
                    <td>2:15</td>
                    <td>
                      <span class="badge bg-secondary">Não interessado</span>
                    </td>
                    <td>
                      <button class="btn btn-sm btn-outline-primary">
                        <i class="bi bi-eye"></i>
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Footer fixo -->
<div class="footer-fixed">
  <div class="footer-left">
    <span class="text-muted">
      <i class="bi bi-info-circle"></i>
      Status: <span class="bold-text">Aguardando</span>
    </span>
  </div>
  <div class="footer-right">
    <button class="footer-btn" title="Pausar atendimento">
      <i class="bi bi-pause"></i>
      Pausar
    </button>
    <div class="dropdown">
      <button
        class="footer-btn dropdown-toggle"
        type="button"
        data-bs-toggle="dropdown"
      >
        <i class="bi bi-three-dots"></i>
        Mais
      </button>
      <ul class="dropdown-menu dropdown-menu-end">
        <li>
          <a class="dropdown-item" href="#">
            <i class="bi bi-gear"></i>Configurações
          </a>
        </li>
        <li>
          <a class="dropdown-item" href="#">
            <i class="bi bi-journal-text"></i>Histórico
          </a>
        </li>
        <li><hr class="dropdown-divider" /></li>
        <li>
          <a class="dropdown-item text-danger" href="#">
            <i class="bi bi-power"></i>Deslogar
          </a>
        </li>
      </ul>
    </div>
  </div>
</div>

<!-- Offcanvas para Agendamento -->
<div
  class="offcanvas offcanvas-end"
  tabindex="-1"
  id="offcanvasAgendamento"
  aria-labelledby="offcanvasAgendamentoLabel"
>
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" id="offcanvasAgendamentoLabel">
      <i class="bi bi-calendar-plus"></i>Agendar Retorno
    </h5>
    <button
      type="button"
      class="btn-close"
      data-bs-dismiss="offcanvas"
      aria-label="Close"
    ></button>
  </div>
  <div class="offcanvas-body">
    <form>
      <div class="mb-3">
        <label for="clienteNome" class="form-label">
          <i class="bi bi-person"></i>Nome do Cliente
        </label>
        <input
          type="text"
          class="form-control"
          id="clienteNome"
          placeholder="Digite o nome do cliente"
        />
      </div>
      <div class="mb-3">
        <label for="clienteTelefone" class="form-label">
          <i class="bi bi-telephone"></i>Telefone
        </label>
        <input
          type="tel"
          class="form-control"
          id="clienteTelefone"
          placeholder="(11) 99999-9999"
        />
      </div>
      <div class="mb-3">
        <label for="dataAgendamento" class="form-label">
          <i class="bi bi-calendar"></i>Data
        </label>
        <input type="date" class="form-control" id="dataAgendamento" />
      </div>
      <div class="mb-3">
        <label for="horaAgendamento" class="form-label">
          <i class="bi bi-clock"></i>Horário
        </label>
        <input type="time" class="form-control" id="horaAgendamento" />
      </div>
      <div class="mb-3">
        <label for="observacoes" class="form-label">
          <i class="bi bi-journal-text"></i>Observações
        </label>
        <textarea
          class="form-control"
          id="observacoes"
          rows="4"
          placeholder="Observações sobre o agendamento..."
        ></textarea>
      </div>
    </form>
  </div>
  <div class="offcanvas-footer p-3 bg-light">
    <div class="d-flex gap-2">
      <button
        type="button"
        class="btn btn-secondary flex-fill"
        data-bs-dismiss="offcanvas"
      >
        <i class="bi bi-x"></i>Cancelar
      </button>
      <button type="button" class="btn btn-primary flex-fill">
        <i class="bi bi-check"></i>Agendar
      </button>
    </div>
  </div>
</div>

@section Scripts {    
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Marcar botão de atendimento como ativo no navbar
        const atendimentoBtn = document.querySelector('[onclick="window.location.href=\'/Atendimento\'"]');
        if (atendimentoBtn) {
          // Remover active de outros botões
          document.querySelectorAll('.icon-btn').forEach(btn => btn.classList.remove('active'));
          // Adicionar active ao botão de atendimento
          atendimentoBtn.classList.add('active');
        }

        // Simular atualizações em tempo real
        function updateStats() {
          // Simular mudanças nos números dos cards
          const cards = document.querySelectorAll('.card .fw-bold');
          if (cards.length >= 4) {
            // Atendimentos hoje
            const currentAttendances = parseInt(cards[0].textContent);
            if (Math.random() > 0.95) { // 5% chance de incrementar
              cards[0].textContent = currentAttendances + 1;
            }
            
            // Tempo médio (simular variação)
            const tempos = ['4:32', '4:28', '4:35', '4:41', '4:26'];
            if (Math.random() > 0.98) { // 2% chance de mudar
              cards[1].textContent = tempos[Math.floor(Math.random() * tempos.length)];
            }
          }
        }

        // Atualizar estatísticas a cada 5 segundos
        setInterval(updateStats, 5000);

        // Atalhos de teclado específicos da página
        document.addEventListener('keydown', function(e) {
          const ctrl = e.ctrlKey || e.metaKey;
          const key = e.key.toLowerCase();

          // Ctrl + A → Abrir Agendamento
          if (ctrl && key === 'a') {
            e.preventDefault();
            const offcanvasAgendamento = document.getElementById('offcanvasAgendamento');
            if (offcanvasAgendamento) {
              const offcanvas = new bootstrap.Offcanvas(offcanvasAgendamento);
              offcanvas.show();
            }
          }

          // Ctrl + P → Pausar
          if (ctrl && key === 'p') {
            e.preventDefault();
            const pauseButton = document.querySelector('.footer-btn[title="Pausar atendimento"]');
            if (pauseButton) {
              pauseButton.click();
            }
          }
        });
      });
    </script>
}